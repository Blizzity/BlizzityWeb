"use strict";function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}document.addEventListener("DOMContentLoaded",function(){var App={init:function init(data){this.renderPlatforms(data.metrics.categories);this.renderCampaigns(data.braveAds);this.renderGrowthChart(data.metrics.growth);this.renderTransactions(data.transactions);this.renderMauDaus(data.users)},renderMauDaus:function renderMauDaus(userMetrics){var mauEl=document.querySelector("[data-hydrate=\"mau\"]");var dauEl=document.querySelector("[data-hydrate=\"dau\"]");var monthYearEl=document.querySelector("[data-hydrate=\"monthYear\"]");var latestData=Object.entries(userMetrics).reduce(function(accumulator,_ref){var _ref2=_slicedToArray(_ref,2),date=_ref2[0],data=_ref2[1];// Date format may change in future
if(/\d{4}-\d{2}/.test(date)){var _date$split=date.split("-"),_date$split2=_slicedToArray(_date$split,2),year=_date$split2[0],month=_date$split2[1];var monthName=new Intl.DateTimeFormat("en",{month:"long",timeZone:"UTC"}).format(new Date(date));var mau=data.mau;var dau=data.dau;if(date>accumulator.dateString){accumulator.year=year;accumulator.mau=mau/1e6;accumulator.dau=dau/1e6;accumulator.monthName=monthName;accumulator.dateString=date}}return accumulator},{dateString:"",year:0,mau:0,dau:0,monthName:""});mauEl.textContent=latestData.mau.toLocaleString()+" Million";dauEl.textContent=latestData.dau.toLocaleString()+" Million";monthYearEl.textContent=latestData.monthName+", "+latestData.year},renderPlatforms:function renderPlatforms(data){var table=document.querySelector("[data-hydrate=\"platforms\"]");table.removeChild(table.tBodies[0]);var tBody=table.createTBody();for(var category in data){var entry=data[category];var row=tBody.appendChild(document.createElement("tr"));row.className=category.toLowerCase();row.appendChild(document.createElement("td")).textContent=category;row.appendChild(document.createElement("td")).textContent=entry.toLocaleString()}},renderGrowthChart:function renderGrowthChart(growthMetrics){var data=Object.entries(growthMetrics).sort(function(a,b){return a[0]<b[0]?-1:1});var canvas=document.querySelector("[data-hydrate=\"growth-chart\"]");var context=canvas.getContext("2d");var chart=new Chart(context,{type:"line",data:{labels:data.map(function(x){return x[0].toUpperCase()}),datasets:[{data:data.map(function(x){return x[1]}),backgroundColor:"transparent",borderColor:"white",borderWidth:1,pointRadius:0}]},options:{responsive:false,tooltips:{enabled:false},title:{display:false},legend:{display:false},scales:{xAxes:[{ticks:{fontSize:9,fontColor:"white",maxRotation:0,autoSkipPadding:5,callback:function callback(value){return new Intl.DateTimeFormat("en",{month:"short",timeZone:"UTC"}).format(new Date(value)).toUpperCase()}}}],yAxes:[{ticks:{min:1e3,fontSize:10,fontColor:"white",callback:function callback(value,index){if(index%2!==0){return value/1000+"k"}return null}}}]}}})},renderTransactions:function renderTransactions(data){var tbody=document.querySelector("[data-hydrate=\"recent-transactions\"]").createTBody();var transactions=[];for(var prop in data){var txn=data[prop];transactions.push({id:prop,date:new Date(txn.date).toISOString().substr(0,10),bat:txn.BAT,site:txn.site})}transactions.sort(function(a,b){return Date.parse(a.date)>Date.parse(b.date)?-1:1});transactions.forEach(function(transaction){var newRow=document.createElement("tr");newRow.appendChild(document.createElement("td")).textContent=transaction.date;newRow.appendChild(document.createElement("td")).textContent=parseInt(transaction.bat).toLocaleString();var platCell=newRow.appendChild(document.createElement("td"));platCell.innerHTML=transaction.site;if(transaction.site==="Uphold"){var receiptLink=document.createElement("a");receiptLink.innerHTML=" <i style=\"margin-left: 1em\" class=\"fas fa-external-link-alt text-xs\"></i>";receiptLink.href="https://uphold.com/reserve/transactions/"+transaction.id;platCell.append(" ",receiptLink)}tbody.appendChild(newRow)})},renderCampaigns:function renderCampaigns(data){var list=document.querySelector("[data-hydrate=\"brave-ads\"]");data.forEach(function(entry){entry.name=entry.name.replace("United States","USA");var text=entry.name+" ("+entry.count+")";list.appendChild(document.createElement("li")).textContent=text})}};fetch("/transparency-data.json").then(function(data){return data.json()}).then(function(json){App.init(json)})});
